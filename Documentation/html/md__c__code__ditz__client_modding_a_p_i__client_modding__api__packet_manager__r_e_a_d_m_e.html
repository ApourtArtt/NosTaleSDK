<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Client Modding Api: PacketManager</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Client Modding Api
   </div>
   <div id="projectbrief">Client modding api for the MMORPG Nostale</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="class_packet_manager.html" title="Class that holds all packet related stuff (Hooking and Custom packets).">PacketManager</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>It is useful for modding some things. Example : there is no packet in game for changing map fog color. If we want the server to set it to clients, we need the server to send the packet, and the client to handle it. \ Sending the packet from game server is out of scope of this documentation and not handled in the client modding project. \ The only work required in the client modding project, is to handle the packet received by the game server.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
How to read sent/received packets :</h1>
<div class="fragment"><div class="line"><span class="comment">// Read a received packet (ex: mv) :</span></div>
<div class="line">packetMng.Subscribe(<a class="code" href="_packet_manager_8h.html#a0a80a7bc045affcf10846075b88cbca0ac1f89b90a18e92dbebed193e346d5dc0">PacketType::RCVD</a>, <span class="stringliteral">&quot;mv&quot;</span>, [&amp;](std::string&amp; Packet)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Do whatever you want with the packet, you can print it for example</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Received : &quot;</span> &lt;&lt; Packet &lt;&lt; std::endl;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read a sent packet (ex: walk) :</span></div>
<div class="line">packetMng.Subscribe(<a class="code" href="_packet_manager_8h.html#a0a80a7bc045affcf10846075b88cbca0a145d630174eaf95ef13b8a02f76e1f75">PacketType::SENT</a>, <span class="stringliteral">&quot;walk&quot;</span>, [&amp;](std::string&amp; Packet)</div>
<div class="line">{</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Sent : &quot;</span> &lt;&lt; Packet &lt;&lt; std::endl;</div>
<div class="line">});</div>
<div class="ttc" id="a_packet_manager_8h_html_a0a80a7bc045affcf10846075b88cbca0a145d630174eaf95ef13b8a02f76e1f75"><div class="ttname"><a href="_packet_manager_8h.html#a0a80a7bc045affcf10846075b88cbca0a145d630174eaf95ef13b8a02f76e1f75">PacketType::SENT</a></div><div class="ttdeci">@ SENT</div></div>
<div class="ttc" id="a_packet_manager_8h_html_a0a80a7bc045affcf10846075b88cbca0ac1f89b90a18e92dbebed193e346d5dc0"><div class="ttname"><a href="_packet_manager_8h.html#a0a80a7bc045affcf10846075b88cbca0ac1f89b90a18e92dbebed193e346d5dc0">PacketType::RCVD</a></div><div class="ttdeci">@ RCVD</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
How to send/receive a packet :</h1>
<div class="fragment"><div class="line"><span class="comment">// Send a packet (example: preq). It is the packet sent to trigger a portal (to change map)</span></div>
<div class="line">packetMng.Send(<span class="stringliteral">&quot;preq&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Receive a packet (example: gold)</span></div>
<div class="line">packetMng.Receive(<span class="stringliteral">&quot;gold 1500000 0&quot;</span>);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
How to add the above functionality ?</h1>
<p>Let's do the example described in the introduction : we are receiving a packet from the game server telling the client modding project to change the color of the map fog color. \ First, we need to know the packet structure, you can't guess it. It is maybe documented in the Game Server project, but you can just ask me. The packet will probably be something like <code>map_fog_color [red_value] [green_value] [blue_value]</code>. Example : <code>map_fog_color 255 0 0</code> set the map fog to completely red. \ We have the header : <code>map_fog_color</code> and we know there are 3 parameters splitted by space. We can start writing it. </p><div class="fragment"><div class="line">packetMng.Subscribe(PacketType::Rcvd <span class="comment">/* We are receiving it from Game server */</span>, <span class="stringliteral">&quot;map_fog_color&quot;</span> <span class="comment">/* The packet header */</span>, [&amp;](std::string&amp; Packet)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Packet will be something like &quot;map_fog_color 255 0 0&quot;</span></div>
<div class="line">    <span class="keyword">auto</span> packs = Split(Packet, <span class="stringliteral">&quot; &quot;</span>); <span class="comment">// Split packet by space, so we can access every parameters easily</span></div>
<div class="line">    <span class="comment">// packs is a list of string : packs[0] = &quot;map_fog_color&quot;, packs[1] = &quot;255&quot; (red), packs[2] = &quot;0&quot; (green), packs[3] = &quot;0&quot; (blue)</span></div>
<div class="line">    <span class="comment">// Since they are strings, we must convert red green and blue to integer value (from 0 to 255)</span></div>
<div class="line">    <span class="comment">// uint8_t is exactly the value we want : 0 to 255 (1 byte, 8 bits)</span></div>
<div class="line">    uint8_t red = ToNumber(packs[1]);</div>
<div class="line">    uint8_t green = ToNumber(packs[2];</div>
<div class="line">    uint8_t blue = ToNumber(packs[3]);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Now, we are perfectly handling the packet structure, the only thing left to do is to use those values.</span></div>
<div class="line">    <span class="comment">// mapCom  is documented here : https://github.com/DitzProject/ClientModdingAPI/tree/main/ClientModding/Api/CustomClasses/MapCommon</span></div>
<div class="line">    <span class="comment">// Set red value :</span></div>
<div class="line">    mapCom.fog.SetRed(red);</div>
<div class="line">    mapCom.fog.SetGreen(green);</div>
<div class="line">    mapCom.fog.SetBlue(blue);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Done ! Everytime you&#39;ll receive the packet &quot;map_fog_color [red] [green] [blue]&quot;, the fog color will be changed to the wanted values</span></div>
<div class="line">});</div>
</div><!-- fragment --><p>Note that it can be written shorter : </p><div class="fragment"><div class="line">packetMng.Subscribe(PacketType::Rcvd, <span class="stringliteral">&quot;map_fog_color&quot;</span>, [&amp;](std::string&amp; Packet)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> packs = Split(Packet, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">    mapCom.fog.SetRed(ToNumber(packs[1]));</div>
<div class="line">    mapCom.fog.SetGreen(ToNumber(packs[2]));</div>
<div class="line">    mapCom.fog.SetBlue(ToNumber(packs[3]));</div>
<div class="line">});</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
